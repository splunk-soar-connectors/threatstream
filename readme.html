<!-- File: readme.html
 Copyright (c) 2016-2022 Splunk Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under
the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the License for the specific language governing permissions
and limitations under the License.
-->

<p><b>Playbook Backward Compatibility</b>
	<ul>
		<li>New action parameters have been added to the actions given below. Hence, it is requested to the end-user please update their existing playbooks and provide values to these new action parameters to ensure the correct functioning of the playbooks created on the earlier versions of the app.</li>
        <ul>
            <li><b>For version 3.4.X :</b></li>
            <ul>
                <li>Import domain observable - <b>source</b> parameter has been added</li>
                <li>Import URL observable - <b>source, allow_unresolved</b> parameters have been added</li>
                <li>Import IP observable - <b>source</b> parameter has been added</li>
                <li>Import file observable - <b>source</b> parameter has been added</li>
                <li>Import email observable - <b>source</b> parameter has been added</li>
                <li>Detonate file - <b>use_premium_sandbox, use_vmray_sandbox, vmray_max_jobs, fields</b> parameters have been added</li>
                <li>Detonate URL - <b>use_premium_sandbox, use_vmray_sandbox, vmray_max_jobs, fields</b> parameters have been added</li>
            </ul>
			<li><b>For version 3.0.X :</b></li>
            <ul>
                <li>Import domain observable - <b>with_approval, allow_unresolved</b> parameters have been added</li>
                <li>Import URL observable - <b>with_approval</b> parameter has been added</li>
                <li>Import IP observable - <b>with_approval</b> parameter has been added</li>
                <li>Import file observable - <b>with_approval</b> parameter has been added</li>
                <li>Import email observable - <b>with_approval</b> parameter has been added</li>
                <li>Import observables - <b>with_approval, allow_unresolved</b> parameters have been added</li>
                <li>List threat models - <b>publication_status</b> parameter has been added</li>
            </ul>
            <li><b> For version 2.0.9 : </b></li>
            <ul>
                <li>Create Incident - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import domain observable - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import URL observable - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import IP observable - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import file observable - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import email observable - <b>create_on_cloud</b> parameter has been added</li>
                <li>Import observables - <b>create_on_cloud</b> parameter has been added</li>
            </ul>
		</ul>
	</ul>
</p>

<p><b>Asset Configuration Parameters</b>
	<ul>
		<li><b>is_cloud_instance</b> - This boolean parameter is used to indicate whether the Anomali Threatstream instance is on the cloud. If the parameter is left unchecked, the app and its functionalities will internally consider it as an on-prem instance.</li>
	</ul>
</p>

<p><b>Prerequisite for [Delete Incident / Delete Actor / Delete Vulnerability / Delete Rule / Delete Threat Bulletin] actions</b>
	<ul>
		<li>The authenticated user in the app should have appropriate permissions (Organization Admin) for deleting the incidents/actors/vulnerabilities/rules/threat-bulletins on the Anomali Threatstream instance for these actions to be executed successfully.</li>
	</ul>
</p>

<p><b>Behavior for [Whois IP] action</b>
	<ul>
		<li>If the action can fetch additional whois data for the provided IP then, the action will pass successfully with that additional data.</li>
		<li>If the action is unable to fetch additional whois data for the provided IP then, the action will pass successfully without that additional data but with an appropriate message.</li>
	</ul>
</p>

<p><b>Behavior for Domain Reputation</b>
	<ul>
		<li>The action will try to find an intelligence with the same name provided in the [domain] parameter in the Anomali ThreatStream instance. If it is not found, then 'None' will be displayed under the corresponding columns in the output view.</li>
		<li>If the provided domain is not found as intelligence in the Anomali ThreatStream instance, then the user needs to import a domain observable with the provided domain as input and then try to re-run the [domain reputation] action.</li>
	</ul>
</p>

<p><b>On Poll Functionality</b>
	<ul>
		<li>It fetches the incidents (belonging to the configured organization ID in the configuration parameters) and their intelligence data to ingest them as containers and artifacts.</li>
		<li>Approaches for fetching incidents based on the <b>Ingest only incidents marked published</b> configuration parameter</li>
			<ul>
				<li>Parameter kept unchecked: Ingesting all the incidents irrespective of their publication status</li>
				<li>Parameter kept checked: Ingesting the incidents which are only in the published state</li>
			</ul>
		<li>Types of polling</li>
		<ul>
			<li>Manual Polling</li>
			<ul>
				<li>All the incidents are fetched, controlled by the count mentioned in the container_count parameter in the oldest first order based on the <b>modified_ts</b> value of the incidents irrespective of the incidents fetched in the last run. If the user tries to run the manual polling again with a value less than the already ingested incidents, then, again the same incidents will be fetched starting from the oldest first and will be marked as duplicates. It is recommended to run manual polling using a relatively greater value in the container_count parameter to ensure all the incidents are ingested.</li>
				<li>The <b>modified_ts</b> time of the last fetched incident is not considered for consequent runs of the manual polling.</li>
			</ul>

			<li>Scheduled | Interval Polling</li>
			<ul>
				<li>Same functionality as manual polling along with the additional points mentioned below:</li>
				<ul>
					<li><b>The maximum number of incidents to poll in the first run of the scheduled polling</b> configuration parameter governs the number of incidents fetched in the first run.</li>
					<li>The <b>modified_ts</b> time of the last fetched incident is stored in the <b>last_incident_time</b> key of the state file.</li>
					<li>For the consecutive runs, the incidents are fetched starting from the time stored in the <b>last_incident_time</b> key of the state file.</li>
					<li>Please provide a larger value in the <b>Maximum number of incidents to poll in the first run of the scheduled polling</b> configuration parameter to fetch all the existing (older) incidents in the first run itself. From the consecutive runs, the newly created or the modified incidents will be automatically ingested.</li>
				</ul>
			</ul>
		</ul>
	</ul>
</p>

<p><b>Behavior for [Create vulnerability / Update vulnerability / Create actor / Update Actor / Create threat bulletin / Update threat bulletin] actions</b>
	<ul>
		<li>Trusted circles are not available locally on On-prem (Hybrid) instance.</li>
	</ul>
</p>

<p><b>Behavior for [Create vulnerability / Update vulnerability / Create actor / Update Actor / Create threat bulletin / Update threat bulletin / Create incident / Update incident] actions</b>
	<ul>
		<li>The action uses different API endpoints for creating / updating an entity and associating intelligence, attachments, import sessions or comments to the entity.</li>
		<li>If the action fails to associate the intelligence, attachments, import sessions or comments while creating an entity, the user can associate them by running the Update action with valid inputs.</li>
	</ul>
</p>

<p><b>Confidence action parameter for import observable related actions</b>
	<ul>
		<li>For [import file observable] and [import email observable] actions user has to provide the confidence value in [confidence] action parameter.</li>
		<li>For [import domain observable], [import ip observable], and [import url observable] actions ThreatStream automatically gives the confidence value based on some internal logical operations | processes as per the API documentation.</li>
		<li>For [import observable] action user can provide confidence value in 'fields' parameter as {"confidence": &lt;confidence_value&gt;}.</li>
		<ul>
			<li>For hash and email type of observable, the value of the confidence will be reflected.</li>
			<li>For domain, IP, and URL type of observable, the value of the confidence will be ignored.</li>
		</ul>
	</ul>
</p>

<p><b>Behavior of import_&lt;indicator_type&gt;_observable and the import_observables actions</b>
	<ul>
		<li>The action run just sends a request for importing the observable value to the Anomali server.</li>
		<li>The action run is a success if a response of <b>202 Accepted</b> is returned by the Anomali API. The action does not wait for the observable to reflect on the Anomali UI.</li>
		<li>The successful run of the actions does not guarantee the successful import of the observable on the Anomali server</li>
		<ul>
			<li>If the provided parameters and their expected combinations are correct, then the observable will be successfully imported after an indefinite interval of time (based on the Anomali server).</li>
			<li>If the provided parameters and their combinations are incorrect, then the action run would be a success (because the API does not return an error response for this and accepts the request) though the observable is not imported on the Anomali server.</li>
		</ul>
		<li>It is recommended to add a required time delay between the action blocks which are dependent on the successful import of an observable.</li>
		<li>To check if the observable was successfully imported, the user can run and check the <b>List Observables</b> action which fetches the observables in the latest first order (based on <b>created_ts</b> time).</li>
	</ul>
</p>

<p>
    <b>List of indicator types (itype) for the import_&lt;indicator_type&gt;_observable and the import_observables
        actions (To be given as input when with_approval parameter is set to False)</b>
<table>
    <tr>
        <td>actor_ip</td>
        <td>actor_ipv6</td>
        <td>adware_domain</td>
        <td>adware_registry_key</td>
    </tr>
    <tr>
        <td>anon_proxy</td>
        <td>anon_proxy_ipv6</td>
        <td>anon_vpn</td>
        <td>anon_vpn_ipv6</td>
    </tr>
    <tr>
        <td>apt_domain</td>
        <td>apt_email</td>
        <td>apt_file_name</td>
        <td>apt_file_path</td>
    </tr>
    <tr>
        <td>apt_ip</td>
        <td>apt_ipv6</td>
        <td>apt_md5</td>
        <td>apt_mta</td>
    </tr>
    <tr>
        <td>apt_mutex</td>
        <td>apt_registry_key</td>
        <td>apt_service_description</td>
        <td>apt_service_displayname</td>
    </tr>
    <tr>
        <td>apt_service_name</td>
        <td>apt_ssdeep</td>
        <td>apt_subject</td>
        <td>apt_ua</td>
    </tr>
    <tr>
        <td>apt_url</td>
        <td>bot_ip</td>
        <td>bot_ipv6</td>
        <td>brute_ip</td>
    </tr>
    <tr>
        <td>brute_ipv6</td>
        <td>c2_domain</td>
        <td>c2_ip</td>
        <td>c2_ipv6</td>
    </tr>
    <tr>
        <td>c2_url</td>
        <td>comm_proxy_domain</td>
        <td>comm_proxy_ip</td>
        <td>compromised_domain</td>
    </tr>
    <tr>
        <td>compromised_email</td>
        <td>compromised_ip</td>
        <td>compromised_ipv6</td>
        <td>compromised_service_account</td>
    </tr>
    <tr>
        <td>compromised_url</td>
        <td>crypto_hash</td>
        <td>crypto_ip</td>
        <td>crypto_pool</td>
    </tr>
    <tr>
        <td>crypto_url</td>
        <td>crypto_wallet</td>
        <td>ddos_ip</td>
        <td>ddos_ipv6</td>
    </tr>
    <tr>
        <td>disposable_email_domain</td>
        <td>dyn_dns</td>
        <td>exfil_domain</td>
        <td>exfil_ip</td>
    </tr>
    <tr>
        <td>exfil_ipv6</td>
        <td>exfil_url</td>
        <td>exploit_domain</td>
        <td>exploit_ip</td>
    </tr>
    <tr>
        <td>exploit_ipv6</td>
        <td>exploit_url</td>
        <td>fraud_domain</td>
        <td>fraud_ip</td>
    </tr>
    <tr>
        <td>fraud_md5</td>
        <td>fraud_email</td>
        <td>fraud_url</td>
        <td>free_email_domain</td>
    </tr>
    <tr>
        <td>geolocation_url</td>
        <td>hack_tool</td>
        <td>i2p_ip</td>
        <td>i2p_ipv6</td>
    </tr>
    <tr>
        <td>ipcheck_url</td>
        <td>mal_domain</td>
        <td>mal_email</td>
        <td>mal_file_name</td>
    </tr>
    <tr>
        <td>mal_file_path</td>
        <td>mal_ip</td>
        <td>mal_ipv6</td>
        <td>mal_md5</td>
    </tr>
    <tr>
        <td>mal_mutex</td>
        <td>mal_registry_key</td>
        <td>mal_service_description</td>
        <td>mal_service_displayname</td>
    </tr>
    <tr>
        <td>mal_service_name</td>
        <td>mal_ssdeep</td>
        <td>mal_sslcert_sh1</td>
        <td>mal_ua</td>
    </tr>
    <tr>
        <td>mal_url</td>
        <td>p2pcnc</td>
        <td>p2pcnc_ipv6</td>
        <td>parked_domain</td>
    </tr>
    <tr>
        <td>parked_ip</td>
        <td>parked_ipv6</td>
        <td>parked_url</td>
        <td>pastesite_url</td>
    </tr>
    <tr>
        <td>phish_domain</td>
        <td>phish_email</td>
        <td>phish_ip</td>
        <td>phish_ipv6</td>
    </tr>
    <tr>
        <td>phish_md5</td>
        <td>phish_url</td>
        <td>proxy_ip</td>
        <td>proxy_ipv6</td>
    </tr>
    <tr>
        <td>scan_ip</td>
        <td>scan_ipv6</td>
        <td>sinkhole_domain</td>
        <td>sinkhole_ip</td>
    </tr>
    <tr>
        <td>sinkhole_ipv6</td>
        <td>social_media_url</td>
        <td>spam_domain</td>
        <td>spam_email</td>
    </tr>
    <tr>
        <td>spam_ip</td>
        <td>spam_ipv6</td>
        <td>spam_mta</td>
        <td>spam_url</td>
    </tr>
    <tr>
        <td>speedtest_url</td>
        <td>ssh_ip</td>
        <td>ssh_ipv6</td>
        <td>ssl_cert_serial_number</td>
    </tr>
    <tr>
        <td>suppress</td>
        <td>suspicious_domain</td>
        <td>suspicious_email</td>
        <td>suspicious_ip</td>
    </tr>
    <tr>
        <td>suspicious_reg_email</td>
        <td>suspicious_url</td>
        <td>tor_ip</td>
        <td>tor_ipv6</td>
    </tr>
    <tr>
        <td>torrent_tracker_url</td>
        <td>vpn_domain</td>
        <td>vps_ip</td>
        <td>vps_ipv6</td>
    </tr>
    <tr>
        <td>whois_bulk_reg_email</td>
        <td>whois_privacy_domain</td>
        <td>whois_privacy_email</td>
        <td></td>
    </tr>
</table>
<b>NOTE:</b> If the input contains any indicator_type value except the ones listed above, the action will behave according to the API behavior.
</p>

<p>
    <b>List of threat types (threat_type) for the import_&lt;indicator_type&gt;_observable and the import_observables actions (To be given as input when with_approval parameter is set to True)</b>
    <table>
        <tr>
            <td>adware</td>
            <td>anomalous</td>
            <td>anonymization</td>
            <td>apt</td>
        </tr>
        <tr>
            <td>bot</td>
            <td>brute</td>
            <td>c2</td>
            <td>compromised</td>
        </tr>
        <tr>
            <td>crypto</td>
            <td>data_leakage</td>
            <td>ddos</td>
            <td>dyn_dns</td>
        </tr>
        <tr>
            <td>exfil</td>
            <td>exploit</td>
            <td>fraud</td>
            <td>hack_tool</td>
        </tr>
        <tr>
            <td>i2p</td>
            <td>informational</td>
            <td>malware</td>
            <td>p2p</td>
        </tr>
        <tr>
            <td>parked</td>
            <td>phish</td>
            <td>scan</td>
            <td>sinkhole</td>
        </tr>
        <tr>
            <td>spam</td>
            <td>suppress</td>
            <td>suspicious</td>
            <td>tor</td>
        </tr>
        <tr>
            <td>vps</td>
        </tr>
    </table>
    <b>NOTE:</b> If the input contains any threat_type value except the ones listed above, the action will behave according to the API behavior.
</p>

<h2>Port Information</h2>
  <p>
    The app uses HTTP/HTTPS protocol for communicating with the ThreatStream Server. Below are the default ports used by Splunk SOAR.
    <table>
      <tr class=plain>
        <th>Service Name</th>
        <th>Transport Protocol</th>
        <th>Port</th>
      </tr>
      <tr>
        <td>http</td>
        <td>tcp</td>
        <td>80</td>
      </tr>
      <tr>
        <td>https</td>
        <td>tcp</td>
        <td>443</td>
      </tr>
    </table>
  </p> 

<p>
	<h2>ipwhois</h2>
	This app uses the ipwhois module, which is licensed under the BSD License, Copyright (c) 2013-2019 Philip Hane.
</p>
<p>
	<h2>pythonwhois</h2>
	This app uses the pythonwhois module, which is licensed under the WTFPL License, Copyright (c) 2014 Sven Slootweg.
</p>
<p>
	<h2>dnspython</h2>
	This app uses the dns module, which is licensed under the Freeware (BSD-like) License, Copyright (c) 2018 Bob Halley.
</p>